# SnapFit (스냅핏) — 프로젝트 기획서

> 문서 버전: 1.0  
> 최종 수정: 2025-02-07

---

## 1) 프로젝트 배경 및 문제 정의

### 1.1 시장 배경
모바일 포토북·앨범 제작 시장은 성장 중이지만, 사용자 경험과 완성도 측면에서 다음과 같은 한계가 존재한다.

### 1.2 핵심 문제
| # | 문제 | 상세 |
|---|------|------|
| 1 | **편집 시간 소요** | 모바일에서 크롭·정렬·여백 등 반복 작업이 많아 이탈율이 높음 |
| 2 | **품질 편차** | 결과물 퀄리티가 사용자 역량에 의존해 전환율이 낮음 |
| 3 | **플로우 분산** | 편집→제작→결제→배송조회가 분리·복잡하여 결제 직전 이탈 발생 |
| 4 | **협업 부재** | 가족·연인·친구 단위 공동 제작이 어렵고, 공동 편집·이력 추적 기능 부족 |

---

## 2) 솔루션 개요 및 핵심 가치

### 2.1 솔루션 개요
SnapFit은 **템플릿 기반 자동완성 + 레이어 편집**으로 빠르고 고품질의 결과물을 만들고, **원스톱 제작 플로우**를 제공하는 포토북·앨범 제작 서비스이다.  
**초대 기능**으로 가족·연인·친구와 앨범을 공유하여 함께 편집할 수 있는 **공동 편집(협업)** 을 핵심 기능으로 지원한다.

### 2.2 핵심 가치 제안
| 가치 | 설명 |
|------|------|
| **빠른 고품질** | 템플릿 자동배치/자동크롭 + 레이어 편집(텍스트/스티커/프레임)으로 누구나 고품질 결과물 제작 |
| **원스톱 플로우** | 편집 → 주문 → 결제 → 배송조회까지 한 앱에서 완결 |
| **협업 + 공유** | 초대(링크/코드/이메일)로 다른 유저와 앨범을 공유·공동 편집. "누가/언제/무엇을" 편집했는지 이력(감사 로그) 제공 |
| **Freeze(고정)** | 주문 직전 최종본을 스냅샷으로 고정하여 분쟁·오류 최소화 |

---

## 3) 사용자 플로우

### 3.1 Solo 플로우 (단독 제작)
```
앨범 생성 → 사진 선택 → 템플릿 적용 → 레이어 편집 → 미리보기 → 제작 사양 선택 → 결제 → 배송조회
```

| 단계 | 액션 | 산출물 |
|------|------|--------|
| 1 | 앨범 생성 | 제목, 사이즈, 페이지 수 설정 |
| 2 | 사진 선택 | 갤러리에서 사진 선택 → Asset 업로드 |
| 3 | 템플릿 적용 | 자동배치/자동크롭으로 페이지 구성 |
| 4 | 레이어 편집 | 텍스트, 스티커, 프레임, 배경 편집 |
| 5 | 미리보기 | 인쇄 규격 기반 검증 |
| 6 | 제작 사양 | 사이즈, 용지, 제본 등 선택 |
| 7 | 결제 | PG 연동 결제 |
| 8 | 배송조회 | 주문 상태, 송장, 택배사 조회 |

### 3.2 Collaboration 플로우 (공동 편집·공유) ★ 핵심 기능
**유저가 초대 링크/코드로 다른 사용자를 초대하여 앨범을 함께 편집·공유할 수 있다.**

```
앨범 생성(Owner) → 초대 발송 → 참여자 수락 → 공동 편집(페이지 잠금) + EditLog → Owner Freeze → 결제 → 배송조회
```

| 단계 | 액션 | 산출물 |
|------|------|--------|
| 1 | 앨범 생성 | Owner가 앨범 생성 |
| 2 | **초대 발송** | 초대 링크/코드 또는 이메일·전화번호로 초대 |
| 3 | **참여자 수락** | Editor/Viewer 역할로 참여 |
| 4 | **공동 편집** | 여러 명이 함께 사진 추가·페이지 편집 (페이지 잠금으로 충돌 방지) |
| 5 | **편집 이력** | 누가/언제/무엇을 변경했는지 EditLog 기록 |
| 6 | Owner Freeze | Owner가 최종 확정 후 결제 |
| 7 | 결제·배송조회 | Solo와 동일 |

**협업 지원 기능 요약**
- 초대: 링크·코드·이메일·전화번호 기반
- 역할: Owner(소유자) / Editor(편집 가능) / Viewer(조회만)
- 편집 공유: 페이지 단위 잠금(Page Lock)으로 동시 편집 충돌 방지

---

## 4) 데이터 모델 요약

| 엔티티 | 핵심 필드 | 설명 |
|--------|-----------|------|
| **User** | id, email/phone, name, createdAt | 사용자 |
| **Album** | id, ownerId, title, coverConfig, spec(size,pages), status | 앨범 (DRAFT/FROZEN/ORDERED) |
| **AlbumMember** | albumId, userId, role, invitedBy, status | 멤버십 (OWNER/EDITOR/VIEWER) |
| **Page** | id, albumId, pageIndex, templateId, backgroundConfig | 페이지 |
| **Layer** | id, pageId, type, zIndex, transform, style, assetRef | 레이어 (IMAGE/TEXT/STICKER/FRAME) |
| **Asset** | id, ownerId, kind, s3Key, width, height | 이미지 자산 (ORIGINAL/THUMB/PREVIEW) |
| **EditLog** | id, albumId, actorId, actionType, targetType, targetId, diff, createdAt | 편집 감사 로그 |
| **Snapshot** | id, albumId, version, frozenAt, frozenBy, snapshotDataKey, previewPdfKey | Freeze 스냅샷 |
| **Order** | id, albumId, snapshotId, buyerId, amount, status, shippingInfo, trackingNo, courier | 주문 |

---

## 5) API 설계 개요

### 5.1 인증 (Auth)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/auth/login` | 로그인 |
| POST | `/auth/refresh` | JWT 갱신 |

### 5.2 앨범 (Album)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/albums` | 앨범 생성 |
| GET | `/albums/{id}` | 앨범 조회 |
| POST | `/albums/{id}/invite` | 초대 발송 |
| POST | `/albums/{id}/invite/accept` | 초대 수락 |
| GET | `/albums/{id}/members` | 멤버 목록 |
| GET | `/albums/{id}/logs` | 편집 이력 |
| POST | `/albums/{id}/freeze` | Freeze(제작 확정) |

### 5.3 페이지·레이어·에셋
| Method | Endpoint | 설명 |
|--------|----------|------|
| PUT | `/pages/{id}` | 페이지 수정 |
| PUT | `/layers/{id}` | 레이어 수정 |
| POST | `/assets/presign` | S3 업로드용 Presigned URL 발급 |

### 5.4 주문 (Order)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/orders` | 주문 생성 (snapshotId 필수) |
| GET | `/orders/{id}/tracking` | 배송 조회 |

---

## 6) 기술 스택

### 6.1 클라이언트 (Flutter)
| 구분 | 기술 | 용도 |
|------|------|------|
| UI | Flutter | 크로스플랫폼 앱 |
| 상태관리 | Riverpod | AsyncNotifier, Notifier |
| 아키텍처 | MVVM | View ↔ ViewModel 분리 |
| 네트워크 | Retrofit, Dio | REST API, Interceptor(JWT) |
| 데이터 | Freezed | 불변 DTO/State |
| 보안 | flutter_secure_storage | JWT, 사용자 정보 저장 |

### 6.2 서버 (Backend)
| 구분 | 기술 | 용도 |
|------|------|------|
| API | Spring Boot | REST API |
| 인증 | JWT | 토큰 기반 인증 |
| DB | MariaDB | 영구 저장소 |
| 스토리지 | S3 | 이미지, PDF, 스냅샷 |
| (선택) | Redis | 캐시, 세션 |
| (선택) | Queue/Worker | 백그라운드 렌더링 |

### 6.3 공통 규칙
- Java `Long` ↔ Dart `int`
- `LocalDateTime` ↔ `String` (ISO 8601)
- `@JsonProperty` ↔ `@JsonKey(name: 'x')`

---

## 7) 일정 및 마일스톤

### 7.1 전체 로드맵
| Phase | 기간 | 목표 |
|-------|------|------|
| Phase 1 | M1~M2 | 기반 구축 + Solo 플로우 MVP |
| Phase 2 | M3~M4 | 협업(Collaboration) MVP |
| Phase 3 | M5~M6 | 주문·결제·배송 통합 + 안정화 |

### 7.2 Phase 1: Solo MVP (M1~M2)
| 마일스톤 | 산출물 | 예상 기간 |
|----------|--------|-----------|
| M1.1 | 인증(로그인/회원가입), 앨범 CRUD | 2주 |
| M1.2 | 페이지·레이어 편집, Asset 업로드 | 3주 |
| M1.3 | 템플릿 적용, 미리보기 | 2주 |
| M1.4 | 제작 사양 선택, Freeze 연동 | 2주 |

### 7.3 Phase 2: Collaboration MVP (M3~M4)
| 마일스톤 | 산출물 | 예상 기간 |
|----------|--------|-----------|
| M2.1 | 초대/수락, 멤버 관리 | 2주 |
| M2.2 | 페이지 잠금(Page Lock), EditLog | 3주 |
| M2.3 | UI/UX 마무리, 충돌 처리 | 2주 |

### 7.4 Phase 3: 주문·결제·배송 (M5~M6)
| 마일스톤 | 산출물 | 예상 기간 |
|----------|--------|-----------|
| M3.1 | PG 연동, 주문 생성 | 2주 |
| M3.2 | 배송조회, 송장 연동 | 2주 |
| M3.3 | 성능·안정화, 출시 준비 | 2주 |

### 7.5 핵심 원칙
- **Order는 반드시 snapshotId 참조** — Freeze 후에만 주문 가능
- **협업 MVP**: Page Lock (TTL 2~5분) + EditLog + Freeze
- **향후 확장**: WebSocket 기반 실시간 협업 검토

---

## 부록

- 상세 요구사항: `.cursor/docs/snapfit-requirements.md`
- 기술 규칙: `.cursor/rules/snapfit-technical.mdc`
- 비즈니스 규칙: `.cursor/rules/snapfit-requirements.mdc`
